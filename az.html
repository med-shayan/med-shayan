<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>A–Z Übersicht – Medizinisches Lexikon</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- HEADER -->
<div id="header"></div>

<!-- CONTENT -->
<div class="container">

  <!-- TITEL -->
  <h1 class="lang de">A–Z Übersicht</h1>
  <h1 class="lang fa" dir="rtl">فهرست اصطلاحات پزشکی</h1>

  <!-- BESCHREIBUNG -->
  <p class="lang de">
    Alle medizinischen Fachbegriffe alphabetisch sortiert.
  </p>

  <p class="lang fa" dir="rtl">
    تمام اصطلاحات پزشکی به صورت فهرست مرتب‌شده نمایش داده شده‌اند.
  </p>

  <!-- LISTE -->
  <div id="az-liste" class="az-list"></div>

  <!-- ZURÜCK -->
  <p class="lang de">
    <a href="index.html" class="back-link">
      <span class="arrow">←</span> Zurück zur Übersicht
    </a>
  </p>

  <p class="lang fa" dir="rtl">
    <a href="index.html" class="back-link" dir="rtl">
      بازگشت به صفحه اصلی <span class="arrow">→</span>
    </a>
  </p>

</div>

<!-- FOOTER -->
<div id="footer"></div>

<!-- DATEN -->
<script src="begriffe.js"></script>

<!-- LOGIK -->
<script>
function normalizeFa(text) {
  return text
    .replace(/ي/g, "ی")
    .replace(/ك/g, "ک")
    .replace(/\u200c/g, "")
    .trim();
}

function setLang(lang) {
  localStorage.setItem("lang", lang);

  document.querySelectorAll(".lang").forEach(el => {
    el.style.display = "none";
  });
  document.querySelectorAll(".lang." + lang).forEach(el => {
    el.style.display = "block";
  });

  renderAZ(lang);
}

function renderAZ(lang) {
  const container = document.getElementById("az-liste");
  container.innerHTML = "";

  const sorted = [...begriffe].sort((a, b) => {
    const nameA = lang === "fa" ? normalizeFa(a.name_fa) : a.name_de;
    const nameB = lang === "fa" ? normalizeFa(b.name_fa) : b.name_de;
    return nameA.localeCompare(nameB, lang === "fa" ? "fa" : "de");
  });

  let currentLetter = "";

  sorted.forEach(b => {
    const name = lang === "fa" ? b.name_fa : b.name_de;
    if (!name) return;

    const firstLetter =
      lang === "fa"
        ? normalizeFa(name).charAt(0)
        : name.charAt(0).toUpperCase();

    if (firstLetter !== currentLetter) {
      currentLetter = firstLetter;
      const h2 = document.createElement("h2");
      h2.textContent = firstLetter;
      h2.className = "az-letter";
      container.appendChild(h2);
    }

    const p = document.createElement("p");
    p.innerHTML = `<a href="${b.file}">${name}</a>`;
    container.appendChild(p);
  });
}

/* HEADER & FOOTER */
document.addEventListener("DOMContentLoaded", () => {
  let headerLoaded = false;
  let footerLoaded = false;

  function initLangIfReady() {
    if (headerLoaded && footerLoaded) {
      const lang = localStorage.getItem("lang") || "de";
      setLang(lang);
    }
  }

  fetch("header.html")
    .then(r => r.text())
    .then(h => {
      document.getElementById("header").innerHTML = h;
      headerLoaded = true;
      initLangIfReady();
    });

  fetch("footer.html")
    .then(r => r.text())
    .then(f => {
      document.getElementById("footer").innerHTML = f;
      footerLoaded = true;
      initLangIfReady();
    });
});
</script>

</body>
</html>
